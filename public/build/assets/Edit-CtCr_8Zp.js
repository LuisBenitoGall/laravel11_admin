import{r as v,a as I,j as e,X as U,G as B,S as O,A as W}from"./app-DRj95fl3.js";import{A as $}from"./AdminAuthenticatedLayout-Bvk28IJ_.js";import"./Header-sOAC_5kI.js";import{F as q}from"./FileInput-si-eiBrJ.js";import{I as C}from"./InputError-DR469WsC.js";import{P as G}from"./PrimaryButton-CT79ceK8.js";import{T}from"./TextInput-DHZ4LhQ-.js";import{u as z}from"./useTranslation-BmHTxgDU.js";import{u as J}from"./useSweetAlert-D-bXTlQV.js";import"./Sidebar-Cs0Qbv6j.js";import"./bootstrap.bundle.min-CIHLONa7.js";import"./NavLink-B2TCDQIx.js";import"./Dropdown-CxSOcthg.js";import"./transition-MDSzoOOX.js";import"./OverlayTrigger-BXbmHDr2.js";function M({countries:S=[],formData:N={},setData:c=()=>{},countryField:_="country_id",provinceField:n="province_id",townField:u="town_id",provincesUrl:L="/api/provinces",townsUrl:s="/api/towns",labels:j={country:"Country",province:"Province",town:"Town"}}){const g=z(),[m,l]=v.useState([]),[p,i]=v.useState([]),[y,E]=v.useState({initial:!1,provinces:!1,towns:!1}),[A,P]=v.useState(null),b=N[_]||"",x=N[n]||"";v.useEffect(()=>{const a=N[u];a&&(E(r=>({...r,initial:!0})),P(null),(async()=>{try{const f=(await I.get(`/api/town/${a}`)).data;f&&(f.country_id&&(c(_,String(f.country_id)),await w(f.country_id)),f.province_id&&(c(n,String(f.province_id)),await o(f.province_id)),c(u,String(f.id)))}catch(r){console.error("Error fetching initial town:",r),P(g("Error cargando la ubicación")||"Error loading location")}finally{E(r=>({...r,initial:!1}))}})())},[]),v.useEffect(()=>{b?w(b):(l([]),i([]))},[b]),v.useEffect(()=>{x?o(x):i([])},[x]);const w=async a=>{try{const r=await I.get(L,{params:{country_id:a}});l(Array.isArray(r.data)?r.data:r.data.provinces||[])}catch(r){console.error("Error fetching provinces:",r),l([])}},o=async a=>{try{const r=await I.get(s,{params:{province_id:a}});i(Array.isArray(r.data)?r.data:r.data.towns||[])}catch(r){console.error("Error fetching towns:",r),i([])}},t=a=>{const r=a.target.value;c(_,r),c(n,""),c(u,""),l([]),i([])},h=a=>{const r=a.target.value;c(n,r),c(u,""),i([])},d=a=>{c(u,a.target.value)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"row gy-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:j.country}),e.jsxs("select",{className:"form-select",name:_,value:b,onChange:t,children:[e.jsx("option",{value:"",children:g("opcion_selec")||"Select"}),Array.isArray(S)&&S.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:j.province}),e.jsxs("select",{className:"form-select",name:n,value:x,onChange:h,children:[e.jsx("option",{value:"",children:y.provinces?g("cargando")||"Cargando...":g("opcion_selec")||"Select"}),m.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:j.town}),e.jsxs("select",{className:"form-select",name:u,value:N[u]||"",onChange:d,children:[e.jsx("option",{value:"",children:y.towns?g("cargando")||"Cargando...":g("opcion_selec")||"Select"}),p.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),A&&e.jsx("small",{className:"text-danger",children:A})]})]})})}function re({auth:S,session:N,title:c,subtitle:_,workplace:n,company:u,countries:L}){var w;const s=z(),j=((w=U())==null?void 0:w.props)||{},{showConfirm:g}=J();j.locale,j.languages;const m=j.permissions||{},{data:l,setData:p,errors:i,processing:y}=B({name:n.name||"",description:n.description||"",country_id:n.country_id||"",province_id:n.province_id||"",town_id:n.town_id||"",cp:n.cp||"",address:n.address||"",website:n.website||"",logo:null}),E=o=>{const{name:t,type:h,checked:d,value:a,files:r}=o.target;h==="checkbox"?p(t,d):h==="file"?p(t,r.length?r[0]:null):p(t,a)};function A(o){o.preventDefault();const t=new FormData;t.append("_method","PUT"),Object.entries(l).forEach(([h,d])=>{h==="logo"&&d instanceof File?t.append(h,d):typeof d=="object"&&d!==null?t.append(h,JSON.stringify(d)):d!=null&&t.append(h,d)}),W.post(route("workplaces.update",n.id),t,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>console.log("Centro actualizado"),onError:h=>console.error("Errores:",h),onFinish:()=>console.log("Petición finalizada")})}const P=()=>{g({title:s("logo_eliminar"),text:s("logo_eliminar_confirm"),icon:"warning",onConfirm:()=>{W.delete(route("workplaces.logo.delete",n.id),{preserveScroll:!0,onSuccess:()=>{location.reload()}})}})},b=o=>{if(typeof o!="string")return"";const t=o.trim();return t?t.startsWith("http")||t.startsWith("//")||t.startsWith("/")?t:t.includes("storage/")?"/"+t.replace(/^\/+/,""):t.includes("workplaces/")||t.includes("companies/")?"/storage/"+t.replace(/^\/+/,""):`/storage/workplaces/${t.replace(/^\/+/,"")}`:""},x=[];return m!=null&&m["workplaces.index"]&&x.push({text:s("centros_volver"),icon:"la-angle-left",url:"workplaces.index",params:n.company_id,modal:!1}),m!=null&&m["workplaces.create"]&&x.push({text:s("centro_nuevo"),icon:"la-plus",url:"workplaces.create",params:n.company_id,modal:!1}),m!=null&&m["workplaces.destroy"]&&x.push({text:s("eliminar"),icon:"la-trash",method:"delete",url:"workplaces.destroy",params:[n.id],title:s("centro_trabajo_eliminar"),message:s("centro_trabajo_eliminar_confirm"),modal:!1}),e.jsxs($,{user:S.user,title:c,subtitle:_,actions:x,children:[e.jsx(O,{title:c}),e.jsxs("div",{className:"contents pb-4",children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12",children:e.jsxs("h2",{children:[s("centro_trabajo")," ",e.jsx("u",{children:n.name})]})}),e.jsxs("div",{className:"col-12 mt-2 mb-4",children:[e.jsxs("span",{className:"text-muted me-5",children:[s("empresa"),": ",e.jsx("strong",{children:u.name})]}),e.jsxs("span",{className:"text-muted me-5",children:[s("creado"),": ",e.jsx("strong",{children:n.formatted_created_at})]}),e.jsxs("span",{className:"text-muted me-5",children:[s("actualizado"),": ",e.jsx("strong",{children:n.formatted_updated_at})]})]})]}),e.jsx("form",{onSubmit:A,children:e.jsxs("div",{className:"row gy-3",children:[e.jsxs("div",{className:"col-lg-6",children:[e.jsxs("label",{className:"form-label",children:[s("centro_trabajo"),"*"]}),e.jsx(T,{value:l.name,onChange:o=>p("name",o.target.value),maxLength:150,required:!0}),e.jsx(C,{message:i.name})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:s("descripcion")}),e.jsx("textarea",{className:"form-control",rows:"3",value:l.description,onChange:o=>p("description",o.target.value)}),e.jsx(C,{message:i.description})]}),e.jsx("div",{className:"col-12",children:e.jsx(M,{countries:L,formData:l,setData:p,provincesUrl:"/api/provinces",townsUrl:"/api/towns",labels:{country:s("pais"),province:s("provincia"),town:s("poblacion")}})}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:s("cp")}),e.jsx(T,{value:l.cp,onChange:o=>p("cp",o.target.value),maxLength:6}),e.jsx(C,{message:i.cp})]}),e.jsxs("div",{className:"col-md-8",children:[e.jsx("label",{className:"form-label",children:s("direccion")}),e.jsx(T,{value:l.address,onChange:o=>p("address",o.target.value),maxLength:150}),e.jsx(C,{message:i.address})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:s("website")}),e.jsx(T,{value:l.website,onChange:o=>p("website",o.target.value),maxLength:150}),e.jsx(C,{message:i.website})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:s("logo")}),n.logo?e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("img",{src:b(n.logo),alt:n.name,className:"img-thumbnail me-3",style:{maxWidth:"300px",objectFit:"contain"}}),e.jsx("button",{type:"button",className:"ms-2 btn btn-sm btn-danger",onClick:P,children:e.jsx("i",{className:"la la-trash"})})]}):e.jsx(q,{name:"logo",accept:"image/*",onChange:E,error:i.logo}),e.jsxs("p",{className:"pt-1 text-warning small",children:[e.jsx("span",{className:"me-5",children:s("imagen_formato")}),e.jsxs("span",{className:"me-5",children:[s("imagen_peso_max"),": 1MB"]}),s("imagen_medidas_recomendadas"),": 400x400px"]})]}),e.jsx("div",{className:"mt-4 text-end",children:e.jsx(G,{disabled:y,className:"btn btn-rdn",children:y?s("procesando")+"...":s("guardar")})})]})})]})]})}export{re as default};
