import{r as h,j as e,A as k,a as A,X as P,G as F,S as C}from"./app-Vy3k0dXk.js";import{A as R}from"./AdminAuthenticatedLayout-RXgeCdrB.js";import{I as L}from"./InputError-DMNw4oH7.js";import{P as z}from"./PrimaryButton-DRjProiT.js";import{u as T}from"./useTranslation-bNzddkut.js";import{T as D}from"./Textarea-7Q1X7LaW.js";import{T as B}from"./TextInput-B6FzyUMY.js";import"./Header-CzP3bCHI.js";import"./useSweetAlert-McVN4vy-.js";import"./OverlayTrigger-DvJH8nk_.js";import"./Sidebar-CCn1nLaa.js";import"./bootstrap.bundle.min-B2fMu5hW.js";import"./NavLink-1EYN7PL6.js";import"./Dropdown-C05IHB0O.js";import"./transition-CGU5FYrv.js";import"./draftjs-to-html-rXm3VHoF.js";function I({offset:x=300}){const[u,f]=h.useState(!1);h.useEffect(()=>{const g=()=>{f(window.scrollY>x)};return window.addEventListener("scroll",g),()=>window.removeEventListener("scroll",g)},[x]);const j=()=>{window.scrollTo({top:0,behavior:"smooth"})};return u?e.jsx("button",{type:"button",onClick:j,className:"btn btn-primary position-fixed",style:{bottom:"30px",right:"30px",zIndex:1050,borderRadius:"50%",width:"45px",height:"45px",boxShadow:"0 0 10px rgba(0,0,0,0.2)"},title:"Volver arriba",children:e.jsx("i",{className:"la la-arrow-up"})}):null}function $({modules:x=[],functionalities:u=[],role_permissions:f=[],permissions_all:j=[],roleId:g}){const c=T(),[w,S]=h.useState({}),[b,E]=h.useState(!1),[m,r]=h.useState(f||[]),N=()=>E(s=>!s),d=x.reduce((s,l)=>(s[l.id]=u.filter(t=>t.module_id===l.id),s),{}),p={};u.forEach(s=>{const l=s.slug.toLowerCase().replace(/_/g,"-"),t=j.filter(o=>{const[n]=o.name.split(".");return n===l});p[s.id]=t});const y=(s,l)=>{r(t=>l?[...t,s]:t.filter(o=>o!==s)),k.post(route("roles.set-permission",g),{permission_id:s,assigned:l},{preserveScroll:!0,preserveState:!0,only:[]})},_=async s=>{const t=(p[s]||[]).map(a=>a.id),n=t.every(a=>m.includes(a))?"deselect":"select",i=new Set(m);n==="select"?t.forEach(a=>i.add(a)):t.forEach(a=>i.delete(a)),r([...i]),await A.post(route("roles.set-multiple-permissions",g),{permissions:t,assigned:n==="select"})},v=h.useRef({});return h.useEffect(()=>{u.forEach(s=>{const l=p[s.id]||[],t=l.every(i=>m.includes(i.id)),o=l.some(i=>m.includes(i.id)),n=v.current[s.id];n&&(n.indeterminate=!t&&o)})},[m]),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"row align-items-center mb-3",children:[e.jsx("div",{className:"col-md-9 col-12 mb-2 mb-md-0",children:e.jsx("div",{className:"d-flex flex-wrap",children:x.map(s=>e.jsx("a",{href:`#module-${s.id}`,className:"badge rounded-pill bg-info text-white me-2 mb-2",children:s.label},s.id))})}),e.jsx("div",{className:"col-md-3 col-12 text-md-end text-start",children:e.jsxs("div",{className:"d-inline-flex align-items-center",children:[e.jsx("label",{className:"form-label me-2 mb-0",children:c("permisos_desplegar_todos")}),e.jsx("div",{className:"form-check form-switch",children:e.jsx("input",{className:"form-check-input",type:"checkbox",id:"toggleExpandAll",checked:b,onChange:N})})]})})]}),x.map(s=>{var l;return e.jsxs("div",{id:`module-${s.id}`,className:"mb-5",children:[e.jsx("div",{className:"text-white px-3 py-2 mb-3",style:{backgroundColor:s.color||"#6f42c1",borderRadius:"4px",fontWeight:"bold",textTransform:"uppercase"},children:c(s.label)}),e.jsx("div",{className:"row",children:(l=d[s.id])==null?void 0:l.map(t=>{var o,n;return e.jsx("div",{className:"col-md-4 mb-4",children:e.jsxs("div",{className:"card border",children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",style:{cursor:"pointer"},onClick:()=>S(i=>({...i,[t.id]:!i[t.id]})),children:[c(t.label),e.jsx("i",{className:`la la-angle-down transition-arrow ${b||w[t.id]?"rotate-180":""}`,style:{transition:"transform 0.2s ease-in-out"}})]}),(b||w[t.id])&&e.jsxs("ul",{className:"list-group list-group-flush",children:[(o=p[t.id])==null?void 0:o.map(i=>e.jsxs("li",{className:"list-group-item d-flex align-items-center",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:m.includes(i.id),onChange:a=>y(i.id,a.target.checked)}),i.name]},i.id)),e.jsxs("li",{className:"list-group-item perm-select-all text-muted small d-flex align-items-center",onClick:()=>_(t.id),children:[e.jsx("input",{ref:i=>v.current[t.id]=i,type:"checkbox",className:"form-check-input me-2",checked:(n=p[t.id])==null?void 0:n.every(i=>m.includes(i.id)),readOnly:!0}),c("permisos_selec_todos")]})]})]})},t.id)})})]},s.id)})]})}function te({auth:x,session:u,title:f,subtitle:j,availableLocales:g,role:c,functionalities:w,modules:S,permissions_all:b,module_permissions:E,role_permissions:m}){var t;const r=T(),N=((t=P())==null?void 0:t.props)||{};N.locale,N.languages;const d=N.permissions||{},{data:p,setData:y,errors:_,processing:v}=F({name:c.name||"",description:c.description||""});function s(o){o.preventDefault();const n=new FormData;n.append("_method","PUT"),Object.entries(p).forEach(([i,a])=>{i==="logo"&&a instanceof File?n.append(i,a):typeof a=="object"&&a!==null?n.append(i,JSON.stringify(a)):a!=null&&n.append(i,a)}),k.post(route("roles.update",c.id),n,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>console.log("Role actualizada"),onError:i=>console.error("Errores:",i),onFinish:()=>console.log("PeticiÃ³n finalizada")})}const l=[];return d!=null&&d["roles.index"]&&l.push({text:r("roles_volver"),icon:"la-angle-left",url:"roles.index",modal:!1}),d!=null&&d["roles.create"]&&l.push({text:r("role_nuevo"),icon:"la-plus",url:"roles.create",modal:!1}),d!=null&&d["roles.destroy"]&&l.push({text:r("eliminar"),icon:"la-trash",method:"delete",url:"roles.destroy",params:[c.id],title:r("role_eliminar"),message:r("role_eliminar_confirm"),modal:!1}),e.jsxs(R,{user:x.user,title:f,subtitle:j,actions:l,children:[e.jsx(C,{title:f}),e.jsxs("div",{className:"contents pb-4",children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12",children:e.jsxs("h2",{children:[r("role")," ",e.jsx("u",{children:c.name})]})}),e.jsxs("div",{className:"col-12 mt-2 mb-4",children:[e.jsxs("span",{className:"text-muted me-5",children:[r("creado"),": ",e.jsx("strong",{children:c.formatted_created_at})]}),e.jsxs("span",{className:"text-muted me-5",children:[r("actualizado"),": ",e.jsx("strong",{children:c.formatted_updated_at})]}),e.jsxs("span",{className:"text-muted me-5",children:[r("role_universal"),": ",e.jsx("strong",{children:e.jsx("i",{className:`la ${c.universal?"la-check text-success":"la-ban text-danger"}`})})]})]})]}),e.jsxs("form",{onSubmit:s,children:[e.jsxs("div",{className:"row gy-3",children:[e.jsx("div",{className:"col-lg-6",children:e.jsxs("div",{className:"position-relative",children:[e.jsxs("label",{htmlFor:"name",className:"form-label",children:[r("role"),"*"]}),e.jsx(B,{type:"text",name:"name",value:p.name,onChange:o=>y("name",o.target.value),maxLength:100,required:!0,disabled:!0}),e.jsx(L,{message:_.name})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"position-relative",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:r("descripcion")}),e.jsx(D,{id:"description",name:"description",value:p.description??"",onChange:o=>{console.log("description value",o.target.value),y("description",o.target.value)},className:"form-control"})]})})]}),e.jsx("div",{className:"mt-4 text-end",children:e.jsx(z,{disabled:v,className:"btn btn-rdn",children:v?r("procesando")+"...":r("guardar")})})]}),c.name!=="Super Admin"&&e.jsx($,{modules:S,functionalities:w,role_permissions:m,permissions_all:b,roleId:c.id})]}),e.jsx(I,{offset:300})]})}export{te as default};
