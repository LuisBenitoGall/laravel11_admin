import{r as o,a as H,j as t,S as I,X as J}from"./app-D2BBDCFC.js";import{u as Y,C as Z,R as Q,S as w,F as ee,P as te}from"./useTableManagement-CimlMvBQ.js";import{T as se,a as re}from"./TableExporter-D3yV3r2t.js";import{S as ae}from"./StatusButton-CNGm9NUM.js";import{u as M}from"./useTranslation-CVJluGRe.js";import{r as le}from"./renderCellContent-DnZ9KIBd.js";import{O as y,T as N}from"./OverlayTrigger-D8mD9LjI.js";import"./es-CMu9_e4K.js";import"./floating-ui.dom-CQJTMakY.js";import"./SelectInput-xW4hb1gP.js";import"./TextInput-WxNO9k3W.js";import"./useSweetAlert-D27GvFwx.js";import"./FileSaver.min-Cyq3_crI.js";import"./typeof-QjJsDpFa.js";function ie({company:a,side:x="customers",tableId:m="tblWorkplaces",queryParams:_={},columns:b=null,entityName:f="workplaces",indexRoute:P=null,indexParams:k=null,destroyRoute:W="workplaces.destroy",fetchRoute:S="customers.workplaces.index",filteredDataRoute:O="customers.workplaces.data",filteredDataKey:v="workplaces",labelName:R="centros_trabajo",availableLocales:ne=[]}){const s=M(),C=typeof _=="object"&&_!==null?_:{},[T,h]=o.useState([]),[i,g]=o.useState(null),[$,A]=o.useState(!1),E=o.useCallback(e=>{var F,q,L,D;const r=((F=e==null?void 0:e.town)==null?void 0:F.name)??(e==null?void 0:e.town_name)??(e==null?void 0:e.town)??"",n=((L=(q=e==null?void 0:e.town)==null?void 0:q.province)==null?void 0:L.name)??((D=e==null?void 0:e.province)==null?void 0:D.name)??(e==null?void 0:e.province_name)??"";return r&&n?`${r} (${n})`:r||n||""},[]),U=o.useMemo(()=>[{key:"name",label:s("nombre"),sort:!0,filter:"text",class_th:"",class_td:"",placeholder:s("nombre_filtrar")},{key:"address",label:s("direccion"),sort:!0,filter:"text",class_th:"",class_td:"",placeholder:s("direccion_filtrar")},{key:"cp",label:s("cp"),sort:!0,filter:"text",class_th:"text-center",class_td:"text-center",placeholder:s("cp_filtrar")},{key:"town_province",label:s("poblacion"),sort:!0,filter:"text",class_th:"",class_td:"",placeholder:s("municipio_filtrar"),render:({rowData:e})=>E(e)},{key:"created_at",label:s("fecha_alta"),sort:!0,filter:"date",class_th:"text-center",class_td:"text-end",placeholder:s("fecha_alta"),dateKeys:["date_from","date_to"]}],[s,E]),d=Array.isArray(b)&&b.length?b:U,{sortParams:l,perPage:c,setPerPage:B,visibleColumns:j,toggleColumnVisibility:K,SearchFieldChanged:V,sortChanged:X,filteredData:z,handleDelete:G,queryParams:u}=Y({table:m,allColumnKeys:d.map(e=>e.key),entityName:f,indexRoute:null,destroyRoute:W,filteredDataRoute:O,filteredDataKey:v,labelName:R,queryParams:C,routeParams:k,manualFiltering:!0,onManualFilter:e=>{p({...e,sort_field:l.sort_field,sort_direction:l.sort_direction,per_page:c,page:1})}}),p=o.useCallback(async(e={})=>{if(a!=null&&a.id){A(!0);try{const{data:r}=await H.get(route(S,[a.id]),{params:e}),n=(r==null?void 0:r[v])??r;Array.isArray(n==null?void 0:n.data)?(h(n.data),g(n.meta??null)):Array.isArray(n)?(h(n),g(null)):Array.isArray(r==null?void 0:r.data)?(h(r.data),g(r.meta??null)):(h([]),g(null))}finally{A(!1)}}},[a==null?void 0:a.id,S,v]);return o.useEffect(()=>{p({...C,page:1,per_page:C.per_page||10})},[a==null?void 0:a.id,x]),o.useEffect(()=>{p({...u,sort_field:l.sort_field,sort_direction:l.sort_direction,per_page:c,page:1})},[l.sort_field,l.sort_direction]),o.useEffect(()=>{p({...u,sort_field:l.sort_field,sort_direction:l.sort_direction,per_page:c,page:1})},[c]),t.jsxs("div",{children:[t.jsx(I,{title:s("centros_trabajo")}),t.jsx("div",{className:"row",children:t.jsxs("div",{className:"controls d-flex align-items-center",children:[t.jsx(Z,{columns:d,visibleColumns:j,toggleColumn:K}),t.jsx(Q,{perPage:c,setPerPage:B}),t.jsx(se,{filename:s(R),columns:d,fetchData:e=>z(e)})]})}),t.jsx("div",{className:"table-responsive",children:t.jsxs(re,{className:"table table-nowrap table-striped align-middle mb-0",id:m,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[d.map(e=>t.jsxs("th",{className:`${e.class_th??""} ${j.includes(e.key)?"":"d-none"}`.trim(),children:[s(e.label),e.sort&&t.jsx(w,{name:e.key,sortable:!0,sort_field:u.sort_field,sort_direction:u.sort_direction,sortChanged:X})]},e.key)),t.jsx("th",{className:"text-center",children:s("acciones")})]})}),t.jsx(ee,{columns:d,queryParams:u,visibleColumns:j,SearchFieldChanged:V,indexRoute:null,indexParams:null}),t.jsxs("tbody",{children:[T.map(e=>t.jsxs("tr",{children:[d.map(r=>t.jsx("td",{className:`${r.class_td??""} ${j.includes(r.key)?"":"d-none"}`.trim(),children:le(e[r.key],r,e)},r.key)),t.jsxs("td",{className:"text-end",children:[t.jsx(y,{placement:"top",overlay:t.jsx(N,{className:"ttp-top",children:e.status==1?s("activo"):s("inactivo")}),children:t.jsx(ae,{status:e.status,id:e.id,updateRoute:`${f}.status`,reloadUrl:P&&k?route(P,k):void 0,reloadResource:f,onUpdated:()=>{p({...u,sort_field:l.sort_field,sort_direction:l.sort_direction,per_page:c,page:(i==null?void 0:i.current_page)||1})}})},"status-"+e.id),t.jsx(y,{placement:"top",overlay:t.jsx(N,{className:"ttp-top",children:s("editar")}),children:t.jsx("a",{href:route(`${f}.edit`,e.id),className:"btn btn-sm btn-info ms-1",children:t.jsx("i",{className:"la la-edit"})})},"edit-"+e.id),t.jsx(y,{placement:"top",overlay:t.jsx(N,{className:"ttp-top",children:s("eliminar")}),children:t.jsx("a",{href:route(`${f}.destroy`,e.id),className:"btn btn-sm btn-danger ms-1",title:s("eliminar"),onClick:r=>{r.preventDefault(),G(e.id,()=>{p({...u,sort_field:l.sort_field,sort_direction:l.sort_direction,per_page:c,page:(i==null?void 0:i.current_page)||1})})},children:t.jsx("i",{className:"la la-trash"})})},"delete-"+e.id)]})]},e.id)),!$&&T.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:d.length+1,className:"text-center py-4",children:s("sin_resultados")})}),$&&t.jsx("tr",{children:t.jsxs("td",{colSpan:d.length+1,className:"text-center py-4",children:[s("cargando"),"â€¦"]})})]})]})}),i&&t.jsx(te,{links:i.links,totalRecords:i.total,currentPage:i.current_page,perPage:i.per_page,onPageChange:e=>{p({...u,sort_field:l.sort_field,sort_direction:l.sort_direction,per_page:c,page:e})}})]})}function ve({company:a,side:x="customers"}){var _;M();const m=((_=J())==null?void 0:_.props)||{};return t.jsx("div",{children:t.jsx(ie,{company:a,side:x,tableId:"tblCompanyWorkplaces",entityName:"workplaces",indexRoute:x==="providers"?"providers.edit":"customers.edit",indexParams:a==null?void 0:a.id,fetchRoute:"workplaces.index",filteredDataRoute:"workplaces.filtered-data",filteredDataKey:"workplaces",labelName:"centros_trabajo",availableLocales:m.availableLocales||[],queryParams:m.queryParams||{}})})}export{ve as default};
