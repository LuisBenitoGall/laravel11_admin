import{b as D,G as M,r as f,j as e,X as R,S as B,A as G,x as P}from"./app-ipN4Lpei.js";import{A as V}from"./AdminAuthenticatedLayout-Dnf9viHk.js";import{M as q}from"./react-tooltip.min-Cg_Z_WJL.js";import{u as X}from"./useSweetAlert-CmWHaLPS.js";import{u as E}from"./useTranslation-C25qZZp5.js";import{R as z}from"./ModalTemplate-sNcpIzGK.js";import{I as F}from"./InputError-BRgDUzXy.js";import"./Header-bG4uIAmT.js";import"./TextInput-CkCvusrN.js";import"./OverlayTrigger-p_uRoGhW.js";import"./Sidebar-Dzqm1Vbq.js";import"./bootstrap.bundle.min-C7oov5VN.js";import"./NavLink-BFjf2yvp.js";import"./Dropdown-DaycTqil.js";import"./transition-B_klRBgP.js";import"./floating-ui.dom-CQJTMakY.js";function H({children:c,targetId:l="modal-root"}){const n=document.getElementById(l)||document.body;return D.createPortal(c,n)}function J({show:c,onClose:l,ivaType:n,side:u}){const o=E(),{data:h,setData:p,post:$,processing:a,reset:g,errors:r,clearErrors:b}=M({code:"",name:"",profile:"iva",iva_type_id:null,side:null});f.useEffect(()=>{if(c&&n&&u){const x=y(n),j=o(u==="output"?"repercutido":"soportado");p(_=>({..._,code:"",name:`IVA ${x}% ${j}`,profile:"iva",iva_type_id:Number(n.id),side:u})),b()}},[c,n,u]);const N=()=>{$("/admin/accounting-accounts/store-auto-account",{preserveScroll:!0,onSuccess:()=>{g(),l==null||l()}})};return e.jsx(z,{show:c,onClose:l,onConfirm:N,title:`${o("cuenta_nueva")} — ${(n==null?void 0:n.name)??""} ${y(n)}% (${o(u==="output"?"repercutido":"soportado")})`,confirmText:o(a?"guardando":"guardar"),cancelText:o("cancelar"),confirmDisabled:a,children:e.jsxs("div",{className:"row g-3",children:[e.jsx("p",{className:"text-warning",children:o("cuenta_iva_nueva_texto")}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:o("codigo_manual")}),e.jsx("input",{type:"text",name:"code",className:`form-control ${r.code?"is-invalid":""}`,value:h.code,onChange:x=>p("code",x.target.value),autoComplete:"off",maxLength:30,autoFocus:!0}),e.jsx(F,{message:r.code})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label",children:[o("nombre"),"*"]}),e.jsx("input",{type:"text",name:"name",className:`form-control ${r.name?"is-invalid":""}`,value:h.name,onChange:x=>p("name",x.target.value),autoComplete:"off",maxLength:191,required:!0}),e.jsx(F,{message:r.name})]})]})})}function y(c){const l=(c==null?void 0:c.iva)??(c==null?void 0:c.rate)??0,n=Number.parseFloat(String(l).replace(",","."));return Number.isFinite(n)?n.toLocaleString(void 0,{maximumFractionDigits:2}):0}function ie({auth:c,session:l,title:n,subtitle:u,ivaTypes:o=[],ivaAccounts:h=[],usages:p=[],availableLocales:$}){var k;const a=E(),g=((k=R())==null?void 0:k.props)||{},r=g.permissions||{},b=g.natureLabels||{},{showConfirm:N}=X(),x=()=>{N({title:a("generacion_masiva"),text:a("generacion_masiva_iva_confirm"),icon:"warning",onConfirm:()=>{G.post(route("accounting-accounts.iva-bulk-generate"),{},{preserveScroll:!0})}})},j=[];r!=null&&r["accounting-accounts.index"]&&j.push({key:"back",text:a("cuentas_volver"),icon:"la-angle-left",url:"accounting-accounts.index"}),r!=null&&r["accounting-accounts.create"]&&j.push({key:"bulk",text:a("generacion_masiva"),icon:"la-plus",modal:!0,onClick:x});const _=f.useMemo(()=>{const t={};return(h||[]).forEach(s=>{t[s.id]=s}),t},[h]),v=f.useMemo(()=>{const t={};return(p||[]).forEach(s=>{t[s.iva_type_id]||(t[s.iva_type_id]={}),t[s.iva_type_id][s.side]=s}),t},[p]),[d,S]=f.useState(null),w=(t,s,i,m=null)=>S({type:t,ivaType:s,side:i,usage:m}),A=()=>S(null);function L(t){const s=(t==null?void 0:t.iva)??(t==null?void 0:t.rate)??0,i=Number.parseFloat(String(s).replace(",","."));return Number.isFinite(i)?i.toLocaleString(void 0,{maximumFractionDigits:2}):0}const I=({ivaType:t,side:s})=>{var C;const i=(C=v==null?void 0:v[t.id])==null?void 0:C[s],m=i?_[i.account_id]:null;return e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"align-middle",children:i&&m?e.jsx("div",{className:"d-flex flex-column",children:e.jsxs("span",{className:"fw-semibold",children:[m.name,m.code?` - ${m.code}`:""]})}):e.jsx("span",{className:"text-muted",children:a("sin_cuenta_asignada")})}),e.jsx("td",{className:"align-middle",children:m?e.jsx("span",{className:"badge bg-secondary",children:b[m.nature]??"—"}):e.jsx("span",{className:"text-muted",children:"—"})}),e.jsx("td",{className:"align-middle",children:e.jsxs("div",{className:"btn-group btn-group-sm text-end",role:"group",children:[!i&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"btn btn-info text-white","data-tooltip-id":"tips","data-tooltip-content":a("cuenta_nueva"),onClick:()=>w("create",t,s),children:e.jsx("i",{className:"la la-plus"})}),e.jsx("button",{type:"button",className:"btn btn-secondary text-white","data-tooltip-id":"tips","data-tooltip-content":a("cuenta_selec"),onClick:()=>w("assign",t,s),children:e.jsx("i",{className:"la la-gear"})})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx(P,{href:route("accounting-accounts.edit",m.id),className:"btn btn-info text-white","data-tooltip-id":"tips","data-tooltip-content":a("cuenta_editar"),children:e.jsx("i",{className:"la la-edit"})}),e.jsx("button",{type:"button",className:"btn btn-danger","data-tooltip-id":"tips","data-tooltip-content":a("vinculacion_eliminar"),onClick:()=>w("delete",t,s,i),children:e.jsx("i",{className:"la la-trash"})})]})]})})]})};return e.jsxs(V,{user:c.user,title:n,subtitle:u,actions:j,children:[e.jsx(B,{title:n}),e.jsxs("div",{className:"contents pb-4",children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-3",children:e.jsx("div",{className:"text-muted",children:a("cuentas_iva_texto")})}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"20%"},children:"IVA"}),e.jsx("th",{style:{width:"22%"},children:a("ventas_repercutido")}),e.jsx("th",{style:{width:"8%"},children:a("tipo")}),e.jsx("th",{style:{width:"10%"},className:"text-center",children:a("acciones")}),e.jsx("th",{style:{width:"22%"},children:a("compras_soportado")}),e.jsx("th",{style:{width:"8%"},children:a("tipo")}),e.jsx("th",{style:{width:"10%"},className:"text-center",children:a("acciones")})]})}),e.jsxs("tbody",{children:[o.map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"fw-semibold",children:`${(t==null?void 0:t.name)??""} - ${L(t)}%`}),e.jsx(I,{ivaType:t,side:"output"}),e.jsx(I,{ivaType:t,side:"input"})]},(t==null?void 0:t.id)??`iva-${(t==null?void 0:t.iva)??"x"}-${s}`)),o.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center text-muted py-4",children:a("sin_registros")})})]})]})}),e.jsx(q,{id:"tips",place:"top"}),e.jsx(H,{children:e.jsx(J,{show:(d==null?void 0:d.type)==="create",onClose:A,ivaType:d==null?void 0:d.ivaType,side:d==null?void 0:d.side})})]})]})}export{ie as default};
