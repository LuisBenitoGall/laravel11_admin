import{r as d,j as e,G as J,a as H,S as K,A as W}from"./app-DRj95fl3.js";import{A as X}from"./AdminAuthenticatedLayout-Bvk28IJ_.js";import{u as O}from"./useTranslation-BmHTxgDU.js";import{F as q,a as u,B as S,M}from"./Modal-57pZU0RI.js";import{u as D,y as Q}from"./OverlayTrigger-BXbmHDr2.js";import"./Header-sOAC_5kI.js";import"./useSweetAlert-D-bXTlQV.js";import"./Sidebar-Cs0Qbv6j.js";import"./bootstrap.bundle.min-CIHLONa7.js";import"./NavLink-B2TCDQIx.js";import"./Dropdown-CxSOcthg.js";import"./transition-MDSzoOOX.js";import"./TextInput-DHZ4LhQ-.js";const U=d.createContext(null);U.displayName="InputGroupContext";const L=d.forwardRef(({className:p,bsPrefix:c,as:m="span",...a},b)=>(c=D(c,"input-group-text"),e.jsx(m,{ref:b,className:Q(p,c),...a})));L.displayName="InputGroupText";const Z=p=>e.jsx(L,{children:e.jsx(q,{type:"checkbox",...p})}),ee=p=>e.jsx(L,{children:e.jsx(q,{type:"radio",...p})}),V=d.forwardRef(({bsPrefix:p,size:c,hasValidation:m,className:a,as:b="div",...g},v)=>{p=D(p,"input-group");const t=d.useMemo(()=>({}),[]);return e.jsx(U.Provider,{value:t,children:e.jsx(b,{ref:v,...g,className:Q(a,p,c&&`${p}-${c}`,m&&"has-validation")})})});V.displayName="InputGroup";const G=Object.assign(V,{Text:L,Radio:ee,Checkbox:Z});function se({environment:p,show:c,onClose:m,onSelect:a,selectedId:b=null}){const g=O(),[v,t]=d.useState([]),[N,l]=d.useState(""),[h,I]=d.useState(new Set),[E,k]=d.useState(!1);d.useEffect(()=>{c&&(k(!0),H.get(route("categories.tree",p)).then(r=>{var n;const i=((n=r.data)==null?void 0:n.nodes)??[];t(i);const j=i.filter(o=>!o.parent_id).map(o=>o.id);I(new Set(j))}).finally(()=>k(!1)))},[c,p]);const f=d.useMemo(()=>{const r=new Map;return v.forEach(i=>{const j=i.parent_id??0;r.has(j)||r.set(j,[]),r.get(j).push(i)}),r.forEach(i=>i.sort((j,n)=>(j.position??0)-(n.position??0)||j.name.localeCompare(n.name))),r},[v]);d.useMemo(()=>{const r=new Map;return v.forEach(i=>r.set(i.id,i)),r},[v]);function B(r){const i=new Set(h);i.has(r)?i.delete(r):i.add(r),I(i)}function y(r=0,i=0){const j=f.get(r)||[];return e.jsx("ul",{className:"list-unstyled ms-0",children:j.map(n=>{const o=(f.get(n.id)||[]).length>0,C=h.has(n.id);return!(N.trim()===""||n.name.toLowerCase().includes(N.toLowerCase())||(n.slug||"").toLowerCase().includes(N.toLowerCase())||C)&&N.trim()!==""&&!o?null:e.jsxs("li",{className:"my-1",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-light me-2",onClick:()=>o&&B(n.id),disabled:!o,"aria-label":o?C?"Collapse":"Expand":"Leaf",style:{width:32},children:o?C?"▾":"▸":"•"}),e.jsx("button",{type:"button",className:`btn btn-sm ${b===n.id?"btn-primary":"btn-outline-primary"}`,onClick:()=>a(n),children:n.name}),e.jsx("span",{className:"ms-2 text-muted small",children:n.slug}),n.status===0&&e.jsx("span",{className:"badge bg-secondary ms-2",children:g("inactivo")})]}),o&&C&&e.jsx("div",{className:"ms-4",children:y(n.id,i+1)})]},n.id)})})}return e.jsxs(M,{show:c,onHide:m,size:"lg",backdrop:"static",children:[e.jsx(M.Header,{closeButton:!0,children:e.jsx(M.Title,{children:g("seleccionar_ubicacion")})}),e.jsxs(M.Body,{children:[e.jsxs(G,{className:"mb-3",children:[e.jsx(G.Text,{children:e.jsx("i",{className:"la la-search"})}),e.jsx(u.Control,{placeholder:g("buscar_categoria_o_slug"),value:N,onChange:r=>l(r.target.value)}),e.jsx(S,{variant:"outline-secondary",onClick:()=>l(""),children:g("limpiar")})]}),E?e.jsxs("div",{className:"text-center py-4",children:[g("cargando"),"…"]}):v.length===0?e.jsx("div",{className:"text-center text-muted py-4",children:g("sin_resultados")}):e.jsx("div",{style:{maxHeight:420,overflowY:"auto"},children:y(0,0)})]}),e.jsx(M.Footer,{children:e.jsx(S,{variant:"secondary",onClick:m,children:g("cerrar")})})]})}function je({auth:p,environment:c,mode:m="create",category:a=null,defaults:b=null,title:g,subtitle:v}){const t=O(),N=d.useMemo(()=>{const s={name:"",slug:"",parent_id:null,parent_path:"",positionMode:"end",afterSiblingId:null,status:1};return m==="edit"&&a?{...s,name:a.name??"",slug:a.slug??"",parent_id:a.parent_id??null,parent_path:a.path?a.path.split("/").slice(0,-1).join(" / "):"",status:a.status??1}:b?{...s,...b}:s},[m,a,b]),{data:l,setData:h,post:I,put:E,processing:k,errors:f,transform:B,reset:y}=J(N),[r,i]=d.useState(!1),[j,n]=d.useState([]),[o,C]=d.useState(null);d.useEffect(()=>{if(!l.parent_id){n([]),C(null),h("afterSiblingId",null);return}H.get(route("categories.tree",c)).then(s=>{var $;const w=(($=s.data)==null?void 0:$.nodes)??[],x=new Map(w.map(_=>[_.id,_])).get(l.parent_id);C(x||null);const P=w.filter(_=>(_.parent_id??0)===((x==null?void 0:x.id)??0)).filter(_=>m!=="edit"||_.id!==(a==null?void 0:a.id));P.sort((_,z)=>(_.position??0)-(z.position??0)||_.name.localeCompare(z.name)),n(P)}).catch(()=>n([]))},[l.parent_id,c,m,a==null?void 0:a.id,h]);const A=d.useMemo(()=>{const s=(o==null?void 0:o.path)||"",w=(l.slug||(l.name||"").trim().toLowerCase().replace(/\s+/g,"-")).replace(/[^a-z0-9\-_/]/g,"");return[s,w].filter(Boolean).join("/")},[l.name,l.slug,o]);function T(s,w=!1){s.preventDefault(),B(x=>({...x,parent_id:x.parent_id||null,afterSiblingId:x.positionMode==="after"?x.afterSiblingId:null,slug:x.slug&&x.slug.length?x.slug:null}));const R={preserveScroll:!0,onSuccess:()=>{if(w){const x=l.parent_id;y("name","slug","positionMode","afterSiblingId"),h("positionMode","end"),h("parent_id",x)}else W.visit(route("categories.index",c),{preserveState:!0})}};m==="edit"&&a?E(route("categories.update",[c,a.id]),R):I(route("categories.store",c),R)}const Y=d.useMemo(()=>o!=null&&o.path?o.path.split("/").join(" › "):t("raiz"),[o]),F=[];return F.push({text:t("categorias_volver"),icon:"la-angle-left",url:"categories.index",modal:!1,params:[c]}),e.jsxs(X,{user:p.user,title:g??t("categorias"),subtitle:v??t(m==="edit"?"editar":"nuevo"),actions:F,children:[e.jsx(K,{title:g??t("categorias")}),e.jsx("div",{className:"contents pb-4",children:e.jsx(u,{onSubmit:s=>T(s,!1),children:e.jsxs("div",{className:"row gy-3",children:[e.jsxs("div",{className:"col-lg-6",children:[e.jsxs(u.Group,{className:"mb-3",children:[e.jsxs(u.Label,{className:"fw-semibold",children:[t("categoria"),"*"]}),e.jsx(u.Control,{type:"text",value:l.name,onChange:s=>h("name",s.target.value),placeholder:t("categoria"),autoFocus:!0}),f.name&&e.jsx("div",{className:"text-danger small mt-1",children:f.name})]}),e.jsxs(u.Group,{className:"mb-3",children:[e.jsx(u.Label,{className:"fw-semibold",children:t("slug")}),e.jsxs(G,{children:[e.jsx(G.Text,{children:e.jsx("i",{className:"la la-link"})}),e.jsx(u.Control,{type:"text",value:l.slug,onChange:s=>h("slug",s.target.value),placeholder:t("slug_opcional")})]}),e.jsxs("div",{className:"text-muted small mt-1",children:[t("vista_previa_ruta"),": ",e.jsx("code",{children:A||"/"})]}),f.slug&&e.jsx("div",{className:"text-danger small mt-1",children:f.slug})]}),e.jsxs(u.Group,{className:"mb-3",children:[e.jsx(u.Label,{className:"fw-semibold d-block",children:t("ubicacion_en_arbol")}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsxs(S,{variant:"outline-primary",type:"button",onClick:()=>i(!0),children:[e.jsx("i",{className:"la la-sitemap me-1"}),t("seleccionar_ubicacion")]}),e.jsxs("div",{className:"text-muted small",children:[t("padre"),": ",e.jsx("strong",{children:Y})]}),l.parent_id&&e.jsx(S,{variant:"outline-secondary",size:"sm",type:"button",onClick:()=>h("parent_id",null),children:t("quitar_padre")})]}),f.parent_id&&e.jsx("div",{className:"text-danger small mt-1",children:f.parent_id})]}),e.jsxs(u.Group,{className:"mb-3",children:[e.jsx(u.Label,{className:"fw-semibold",children:t("posicion")}),e.jsxs("div",{className:"row g-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs(u.Select,{value:l.positionMode,onChange:s=>h("positionMode",s.target.value),children:[e.jsx("option",{value:"start",children:t("al_principio")}),e.jsx("option",{value:"end",children:t("al_final")}),e.jsx("option",{value:"after",children:t("despues_de")})]})}),e.jsx("div",{className:"col-md-8",children:e.jsxs(u.Select,{value:l.afterSiblingId??"",onChange:s=>h("afterSiblingId",s.target.value?parseInt(s.target.value,10):null),disabled:l.positionMode!=="after",children:[e.jsx("option",{value:"",children:t("selecciona_hermano")}),j.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})})]}),l.positionMode==="after"&&j.length===0&&e.jsx("div",{className:"text-muted small mt-1",children:t("no_hay_hermanos_para_posicionar")})]}),e.jsxs(u.Group,{className:"mb-3",children:[e.jsx(u.Label,{className:"fw-semibold me-2",children:t("activo")}),e.jsx(u.Check,{type:"switch",id:"statusSwitch",checked:!!l.status,onChange:s=>h("status",s.target.checked?1:0),inline:!0}),f.status&&e.jsx("div",{className:"text-danger small mt-1",children:f.status})]})]}),e.jsx("div",{className:"card-footer d-flex justify-content-between",children:e.jsxs("div",{className:"d-flex gap-2",children:[m==="create"&&e.jsx(S,{type:"button",variant:"outline-primary",disabled:k,onClick:s=>T(s,!0),children:t("guardar_y_crear_otra")}),e.jsx(S,{type:"submit",variant:"primary",disabled:k,children:t("guardar")})]})})]})})}),e.jsx(se,{environment:c,show:r,onClose:()=>i(!1),onSelect:s=>{h("parent_id",(s==null?void 0:s.id)??null),i(!1)},selectedId:l.parent_id})]})}export{je as default};
