import{r as c,j as e,A as I,X as fe,G as ge}from"./app-DRj95fl3.js";import{F as ye}from"./DatePickerToForm-BaY77Ky7.js";import{F as be}from"./FileInput-si-eiBrJ.js";import{I as k}from"./InputError-DR469WsC.js";import{u as Z}from"./useSweetAlert-D-bXTlQV.js";import{u as P}from"./useTranslation-BmHTxgDU.js";import{d as ee,B as X,C as F,M as q,a as g}from"./Modal-57pZU0RI.js";import{u as v,y as N,a as ve,b as Ne,O as R,T as B}from"./OverlayTrigger-BXbmHDr2.js";import{P as Ce}from"./PrimaryButton-CT79ceK8.js";import{R as _e}from"./RadioButton-CJeo2xjw.js";import{S as we}from"./SelectInput-CcScNE44.js";import{T as W}from"./TextInput-DHZ4LhQ-.js";import"./es-D0X2UUFm.js";import"./floating-ui.dom-CQJTMakY.js";/* empty css                         */const K=c.forwardRef(({className:t,bsPrefix:r,as:l="div",...s},n)=>(r=v(r,"card-body"),e.jsx(l,{ref:n,className:N(t,r),...s})));K.displayName="CardBody";const ae=c.forwardRef(({className:t,bsPrefix:r,as:l="div",...s},n)=>(r=v(r,"card-footer"),e.jsx(l,{ref:n,className:N(t,r),...s})));ae.displayName="CardFooter";const se=c.createContext(null);se.displayName="CardHeaderContext";const te=c.forwardRef(({bsPrefix:t,className:r,as:l="div",...s},n)=>{const d=v(t,"card-header"),j=c.useMemo(()=>({cardHeaderBsPrefix:d}),[d]);return e.jsx(se.Provider,{value:j,children:e.jsx(l,{ref:n,...s,className:N(r,d)})})});te.displayName="CardHeader";const re=c.forwardRef(({bsPrefix:t,className:r,variant:l,as:s="img",...n},d)=>{const j=v(t,"card-img");return e.jsx(s,{ref:d,className:N(l?`${j}-${l}`:j,r),...n})});re.displayName="CardImg";const ne=c.forwardRef(({className:t,bsPrefix:r,as:l="div",...s},n)=>(r=v(r,"card-img-overlay"),e.jsx(l,{ref:n,className:N(t,r),...s})));ne.displayName="CardImgOverlay";const le=c.forwardRef(({className:t,bsPrefix:r,as:l="a",...s},n)=>(r=v(r,"card-link"),e.jsx(l,{ref:n,className:N(t,r),...s})));le.displayName="CardLink";const Se=ee("h6"),ie=c.forwardRef(({className:t,bsPrefix:r,as:l=Se,...s},n)=>(r=v(r,"card-subtitle"),e.jsx(l,{ref:n,className:N(t,r),...s})));ie.displayName="CardSubtitle";const oe=c.forwardRef(({className:t,bsPrefix:r,as:l="p",...s},n)=>(r=v(r,"card-text"),e.jsx(l,{ref:n,className:N(t,r),...s})));oe.displayName="CardText";const Fe=ee("h5"),ce=c.forwardRef(({className:t,bsPrefix:r,as:l=Fe,...s},n)=>(r=v(r,"card-title"),e.jsx(l,{ref:n,className:N(t,r),...s})));ce.displayName="CardTitle";const de=c.forwardRef(({bsPrefix:t,className:r,bg:l,text:s,border:n,body:d=!1,children:j,as:_="div",...w},S)=>{const u=v(t,"card");return e.jsx(_,{ref:S,...w,className:N(r,u,l&&`bg-${l}`,s&&`text-${s}`,n&&`border-${n}`),children:d?e.jsx(K,{children:j}):j})});de.displayName="Card";const G=Object.assign(de,{Img:re,Title:ce,Subtitle:ie,Body:K,Link:le,Text:oe,Header:te,Footer:ae,ImgOverlay:ne}),J=c.forwardRef(({bsPrefix:t,className:r,as:l="div",...s},n)=>{const d=v(t,"row"),j=ve(),_=Ne(),w=`${d}-cols`,S=[];return j.forEach(u=>{const p=s[u];delete s[u];let m;p!=null&&typeof p=="object"?{cols:m}=p:m=p;const i=u!==_?`-${u}`:"";m!=null&&S.push(`${w}${i}-${m}`)}),e.jsx(l,{ref:n,...s,className:N(r,d,...S)})});J.displayName="Row";const L=c.forwardRef(({bsPrefix:t,variant:r,animation:l="border",size:s,as:n="div",className:d,...j},_)=>{t=v(t,"spinner");const w=`${t}-${l}`;return e.jsx(n,{ref:_,...j,className:N(d,w,s&&`${w}-${s}`,r&&`text-${r}`)})});L.displayName="Spinner";const $e=t=>{if(!t||typeof t!="string")return"—";const l=t.replace(/\s+/g,"").match(/^\+(\d{1,3})(\d+)$/);if(!l)return t;const s=`+${l[1]}`,d=l[2].replace(/(\d{3})(?=\d)/g,"$1 ").trim();return`${s} ${d}`.trim()},ke=(t,r)=>t?r?`tel:${t};ext=${encodeURIComponent(r)}`:`tel:${t}`:"#",Re=(t,r="")=>{if(!t)return"#";const l=t.replace(/^\+/,""),s=r?`?text=${encodeURIComponent(r)}`:"";return`https://wa.me/${l}${s}`},Be=t=>[...t||[]].sort((r,l)=>r.is_primary&&!l.is_primary?-1:!r.is_primary&&l.is_primary?1:(r.id??0)-(l.id??0));function Ie({phoneableType:t,phoneableId:r,defaultWaMessage:l="Hola"}){const s=P(),{showConfirm:n}=Z(),[d,j]=c.useState(!0),[_,w]=c.useState([]),[S,u]=c.useState(null),[p,m]=c.useState(!1),[i,f]=c.useState(null),[D,z]=c.useState(!1),[U,T]=c.useState(null),[H,A]=c.useState(null),[M,O]=c.useState(null),o=s(l)||l,x=async()=>{if(!(!t||!r)){j(!0),u(null);try{const a=route("phones.get",{id:r,model:t}),h=await fetch(a,{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!h.ok)throw new Error(`HTTP ${h.status}`);const C=await h.json();w(Array.isArray(C)?C:[])}catch(a){u(a.message||"Error")}finally{j(!1)}}};c.useEffect(()=>{x()},[t,r]);const y=c.useMemo(()=>Be(_),[_]),b=()=>{f({id:null,number:"",type:"",label:"",ext:"",is_whatsapp:!1,is_primary:!1,notes:""}),m(!0)},V=a=>{f({id:a.id,number:a.e164,type:a.type||"mobile",label:a.label||"",ext:a.ext||"",is_whatsapp:!!a.is_whatsapp,is_primary:!!a.is_primary,notes:a.notes||""}),m(!0)},E=()=>{D||(m(!1),f(null))},$=(a,h)=>{f(C=>({...C,[a]:h}))},me=a=>{var Q;if((Q=a==null?void 0:a.preventDefault)==null||Q.call(a),!i)return;z(!0),u(null);const h={phoneable_type:t,phoneable_id:r,number:i.number,type:i.type,label:i.label||null,ext:i.ext||null,is_whatsapp:i.is_whatsapp?1:0,is_primary:i.is_primary?1:0,notes:i.notes||null},C={preserveScroll:!0,onSuccess:()=>{x(),E()},onError:Y=>{const je=Y&&Object.values(Y)[0];u(je||s("error_generic"))},onFinish:()=>z(!1)};i.id?I.put(route("phones.update",i.id),h,C):I.post(route("phones.store"),h,C)},xe=async a=>{a&&n({title:s("telefono_eliminar"),text:s("telefono_eliminar_confirm"),icon:"warning",onConfirm:async()=>{T(a),I.delete(route("phones.destroy",a),{preserveScroll:!0,onSuccess:()=>x(),onError:()=>u(s("error_generic")),onFinish:()=>T(null)})}})},ue=a=>{a&&(A(a),u(null),I.post(route("phones.primary"),{phone_id:a,phoneable_type:t,phoneable_id:r},{preserveScroll:!0,onSuccess:()=>{x()},onError:h=>{const C=h&&(typeof h=="string"?h:Object.values(h)[0]);u(C||s("error_generic"))},onFinish:()=>A(null)}))},he=async a=>{try{await navigator.clipboard.writeText(a)}catch{}},pe=a=>{a&&n({title:s("telefono_verificar"),text:s("telefono_verificar_confirm"),icon:"warning",onConfirm:()=>{O(a),u(null),I.post(route("phones.verify"),{phone_id:a},{preserveScroll:!0,onSuccess:()=>{x()},onError:h=>{const C=h&&(typeof h=="string"?h:Object.values(h)[0]);u(C||s("error_generic"))},onFinish:()=>O(null)})}})};return e.jsxs("div",{className:"position-relative mt-5",children:[e.jsx("hr",{}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-4 mb-3",children:[e.jsx("h5",{className:"mb-0",children:s("telefonos")}),e.jsxs(X,{variant:"primary",size:"sm",onClick:b,children:[e.jsx("i",{className:"la la-plus me-1"}),s("telefono")]})]}),d&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(L,{animation:"border",size:"sm",className:"me-2"}),s("cargando")]}),!d&&S&&e.jsx("div",{className:"alert alert-danger mx-0 mb-3",children:s("error_generico")}),!d&&!S&&y.length===0&&e.jsx("div",{className:"text-muted",children:s("telefonos_sin")}),e.jsx(J,{xs:1,md:2,lg:3,className:"g-3",children:y.map(a=>e.jsx(F,{children:e.jsxs(G,{className:`h-100 ${a.is_primary?"border-primary":""}`,children:[e.jsxs(G.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"fw-semibold",children:[$e(a.e164),a.is_primary&&e.jsx("span",{className:"badge bg-primary ms-2",children:s("primario")}),a.is_whatsapp&&e.jsx("i",{className:"la la-whatsapp ms-2","aria-label":"WhatsApp"})]}),a.ext&&e.jsxs("div",{className:"text-muted small",children:[s("extension"),": ",a.ext]})]}),e.jsx("span",{className:`badge ${a.is_verified?"bg-success":"bg-secondary"}`,children:a.is_verified?s("verificado"):s("verificado_no")})]}),(a.label||a.type||a.notes)&&e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"text-muted small",children:[a.label?e.jsxs(e.Fragment,{children:[e.jsxs("strong",{children:[s("etiqueta"),":"]})," ",a.label,e.jsx("br",{})]}):null,a.type?e.jsxs(e.Fragment,{children:[e.jsxs("strong",{children:[s("tipo"),":"]})," ",s(`${a.type}`),e.jsx("br",{})]}):null,a.notes?e.jsxs(e.Fragment,{children:[e.jsxs("strong",{children:[s("notas"),":"]})," ",a.notes]}):null]})})]}),e.jsxs(G.Footer,{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"btn-group",role:"group",children:[e.jsx(R,{placement:"top",overlay:e.jsx(B,{children:s("llamar")}),children:e.jsx("a",{className:"btn btn-sm btn-outline-secondary",href:ke(a.e164,a.ext),children:e.jsx("i",{className:"la la-phone"})})}),!a.is_verified&&e.jsx(R,{placement:"top",overlay:e.jsx(B,{children:s("verificar")}),children:e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>pe(a.id),disabled:M===a.id,children:M===a.id?e.jsx(L,{size:"sm",animation:"border"}):e.jsx("i",{className:"la la-check-circle"})})}),a.is_whatsapp&&e.jsx(R,{placement:"top",overlay:e.jsx(B,{children:"WhatsApp"}),children:e.jsx("a",{className:"btn btn-sm btn-outline-success",href:Re(a.e164,o),target:"_blank",rel:"noopener noreferrer",children:e.jsx("i",{className:"la la-whatsapp"})})}),e.jsx(R,{placement:"top",overlay:e.jsx(B,{children:s("copiar")}),children:e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>he(a.e164),children:e.jsx("i",{className:"la la-copy"})})}),!a.is_primary&&e.jsx(R,{placement:"top",overlay:e.jsx(B,{children:s("primario_marcar")}),children:e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>ue(a.id),disabled:H===a.id,children:H===a.id?e.jsx(L,{size:"sm",animation:"border"}):e.jsx("i",{className:"la la-star"})})})]}),e.jsxs("div",{className:"btn-group",role:"group",children:[e.jsx(R,{placement:"top",overlay:e.jsx(B,{children:s("editar")}),children:e.jsx("button",{className:"btn btn-sm btn-info text-white",onClick:()=>V(a),children:e.jsx("i",{className:"la la-edit"})})}),e.jsx(R,{placement:"top",overlay:e.jsx(B,{children:s("eliminar")}),children:e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>xe(a.id),disabled:U===a.id,children:U===a.id?e.jsx(L,{size:"sm",animation:"border"}):e.jsx("i",{className:"la la-trash"})})})]})]})]})},a.id))}),e.jsx(q,{show:p,onHide:E,backdrop:"static",children:e.jsxs(g,{onSubmit:me,children:[e.jsx(q.Header,{closeButton:!0,children:e.jsx(q.Title,{children:i!=null&&i.id?s("telefono_editar"):s("telefono_nuevo")})}),e.jsxs(q.Body,{children:[S&&e.jsx("div",{className:"alert alert-danger",children:s("error_generico")}),e.jsxs(J,{className:"g-2",children:[e.jsxs(F,{md:8,children:[e.jsxs(g.Label,{children:[s("numero"),"*"]}),e.jsx(g.Control,{type:"text",value:(i==null?void 0:i.number)??"",onChange:a=>$("number",a.target.value),placeholder:"+34600111222",maxLength:14,required:!0})]}),e.jsxs(F,{md:4,children:[e.jsx(g.Label,{children:s("extension")}),e.jsx(g.Control,{type:"text",value:(i==null?void 0:i.ext)??"",onChange:a=>$("ext",a.target.value),placeholder:"123",maxLength:8})]}),e.jsxs(F,{md:6,children:[e.jsx(g.Label,{children:s("tipo")}),e.jsxs(g.Select,{value:(i==null?void 0:i.type)??"",onChange:a=>$("type",a.target.value),children:[e.jsx("option",{value:"",children:s("opcion_selec")}),e.jsx("option",{value:"mobile",children:s("movil")}),e.jsx("option",{value:"landline",children:s("fijo")}),e.jsx("option",{value:"other",children:s("otro")})]})]}),e.jsxs(F,{md:6,children:[e.jsx(g.Label,{children:s("etiqueta")}),e.jsx(g.Control,{type:"text",value:(i==null?void 0:i.label)??"",onChange:a=>$("label",a.target.value),placeholder:s("etiqueta_ej"),maxLength:50})]}),e.jsxs(F,{xs:12,children:[e.jsx(g.Label,{children:s("notas")}),e.jsx(g.Control,{as:"textarea",rows:2,value:(i==null?void 0:i.notes)??"",onChange:a=>$("notes",a.target.value)})]}),e.jsx(F,{md:4,className:"pt-2",children:e.jsx(g.Check,{type:"switch",id:"chk-whatsapp",label:"WhatsApp",checked:!!(i!=null&&i.is_whatsapp),onChange:a=>$("is_whatsapp",a.target.checked)})}),e.jsx(F,{md:4,className:"pt-2",children:e.jsx(g.Check,{type:"switch",id:"chk-primary",label:s("primario"),checked:!!(i!=null&&i.is_primary),onChange:a=>$("is_primary",a.target.checked)})})]})]}),e.jsxs(q.Footer,{children:[e.jsx(X,{variant:"secondary",onClick:E,disabled:D,children:s("cancelar")}),e.jsx(X,{variant:"primary",type:"submit",disabled:D,children:D?e.jsx(L,{size:"sm",animation:"border"}):s("guardar")})]})]})})]})}function Je({user:t,roles:r={},user_roles:l={},salutations:s=[]}){var T,H,A,M,O;const n=P(),d=((T=fe())==null?void 0:T.props)||{},j=d.locale||!1;d.languages;const{showConfirm:_}=Z();d.permissions;const w=((A=(H=d.languages)==null?void 0:H[j])==null?void 0:A[6])||"dd/MM/yyyy",S=Object.entries(r).map(([o,x])=>({value:o,label:x})),u=((O=(M=l==null?void 0:l[0])==null?void 0:M.id)==null?void 0:O.toString())||"",{data:p,setData:m,processing:i,errors:f}=ge({role:u||((t==null?void 0:t.isAdmin)==1?"":"Invitados"),name:t.name||"",surname:t.surname||"",salutation:t.salutation||"",email:t.email||"",nif:t.nif||"",birthday:t.birthday?new Date(t.birthday):null,signature:null}),D=o=>{const{name:x,type:y,checked:b,value:V,files:E}=o.target;y==="checkbox"?m(x,b):y==="file"?m(x,E.length?E[0]:null):m(x,V)};function z(o){o.preventDefault();const x=new FormData;x.append("_method","PUT"),Object.entries(p).forEach(([y,b])=>{y==="signature"&&b instanceof File?x.append(y,b):typeof b=="object"&&b!==null?x.append(y,JSON.stringify(b)):b!=null&&x.append(y,b)}),I.post(route("users.update",t.id),x,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>console.log("Usuario actualizado"),onError:y=>console.error("Errores:",y),onFinish:()=>console.log("Petición finalizada")})}const U=()=>{_({title:n("firma_eliminar"),text:n("firma_eliminar_confirm"),icon:"warning",onConfirm:()=>{I.delete(route("users.signature.delete",t.id),{preserveScroll:!0,onSuccess:()=>{location.reload()}})}})};return e.jsxs("div",{className:"col-12 gy-2",children:[e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"row gy-3 mb-3",children:[(t==null?void 0:t.isAdmin)==1?e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"position-relative",children:[e.jsxs("label",{htmlFor:"role",className:"form-label",children:[n("role"),"*"]}),e.jsx(_e,{name:"role",value:p.role,onChange:o=>m("role",o.target.value),options:S,required:!0}),e.jsx(k,{message:f.role})]})}):e.jsx("input",{type:"hidden",name:"role",value:p.role}),e.jsx("div",{className:"col-md-2",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"salutation",className:"form-label",children:n("tratamiento")}),e.jsxs(we,{className:"form-select",name:"salutation",value:p.salutation,onChange:o=>m("salutation",o.target.value),children:[e.jsx("option",{value:"",children:n("opcion_selec")}),s.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]}),e.jsx(k,{message:f.salutation})]})}),e.jsx("div",{className:"col-md-5",children:e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"name",className:"form-label",children:[n("nombre"),"*"]}),e.jsx(W,{className:"",name:"name",type:"text",placeholder:n("nombre"),value:p.name,onChange:o=>m("name",o.target.value),maxLength:100,required:!0}),e.jsx(k,{message:f.name})]})}),e.jsx("div",{className:"col-md-5",children:e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"surname",className:"form-label",children:[n("apellidos"),"*"]}),e.jsx(W,{className:"",name:"surname",type:"text",placeholder:n("apellidos"),value:p.surname,onChange:o=>m("surname",o.target.value),maxLength:100,required:!0}),e.jsx(k,{message:f.surname})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"email",className:"form-label",children:[n("email"),"*"]}),e.jsx(W,{className:"",name:"email",type:"email",placeholder:n("email"),value:p.email,onChange:o=>m("email",o.target.value),maxLength:100,required:!0}),e.jsx(k,{message:f.email})]})}),e.jsx("div",{className:"col-md-3",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nif",className:"form-label",children:n("nif")}),e.jsx(W,{className:"",name:"nif",type:"text",placeholder:n("nif"),value:p.nif,onChange:o=>m("nif",o.target.value),maxLength:15}),e.jsx(k,{message:f.nif})]})}),e.jsx("div",{className:"col-md-3",children:e.jsxs("div",{className:"position-relative",children:[e.jsx("label",{htmlFor:"birthday",className:"form-label",children:n("fecha_nacimiento")}),e.jsx(ye,{id:"birthday",name:"birthday",selected:p.birthday?new Date(p.birthday):null,onChange:(o,x)=>{m(o,x),x||m("published_end",null)},dateFormat:w}),e.jsx(k,{message:f.birthday})]})}),e.jsx("div",{className:"w-100 m-0"}),(t==null?void 0:t.isAdmin)==1&&e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"signature",className:"form-label",children:n("firma")}),t.signature?e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("img",{src:`/storage/signatures/${t.signature}`,alt:t.name,className:"img-thumbnail me-3",style:{maxWidth:"300px",objectFit:"contain"}}),e.jsx("button",{type:"button",className:"ms-2 btn btn-sm btn-danger",onClick:U,children:e.jsx("i",{className:"la la-trash"})})]}):e.jsx(be,{name:"signature",accept:"image/*",onChange:D,error:f.signature}),e.jsxs("p",{className:"pt-1 text-warning small",children:[e.jsx("span",{className:"me-5",children:n("imagen_formato")}),e.jsxs("span",{className:"me-5",children:[n("imagen_peso_max"),": 1MB"]}),n("imagen_medidas_recomendadas"),": 400x400px"]})]})})]}),e.jsx("div",{className:"mt-4 text-end",children:e.jsx(Ce,{disabled:i,className:"btn btn-rdn",children:i?n("procesando")+"...":n("guardar")})})]}),e.jsx(Ie,{phoneableType:"User",phoneableId:t.id,defaultWaMessage:n("whatsapp_mensaje")})]})}export{Je as default};
