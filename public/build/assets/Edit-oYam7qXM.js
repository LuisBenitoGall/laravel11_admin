import{r as v,a as I,j as e,X as U,G as B,S as O,A as W}from"./app-ipN4Lpei.js";import{A as $}from"./AdminAuthenticatedLayout-Dnf9viHk.js";import"./Header-bG4uIAmT.js";import{F as q}from"./FileInput-Dl7qVaaD.js";import{I as w}from"./InputError-BRgDUzXy.js";import{P as G}from"./PrimaryButton-BZCXfhHb.js";import{T}from"./TextInput-CkCvusrN.js";import{u as z}from"./useTranslation-C25qZZp5.js";import{u as J}from"./useSweetAlert-CmWHaLPS.js";import"./Sidebar-Dzqm1Vbq.js";import"./bootstrap.bundle.min-C7oov5VN.js";import"./NavLink-BFjf2yvp.js";import"./Dropdown-DaycTqil.js";import"./transition-B_klRBgP.js";import"./OverlayTrigger-p_uRoGhW.js";function M({countries:C=[],formData:_={},setData:l=()=>{},countryField:b="country_id",provinceField:r="province_id",townField:p="town_id",provincesUrl:a="/api/provinces",townsUrl:N="/api/towns",labels:y={country:"Country",province:"Province",town:"Town"}}){const i=z(),[u,c]=v.useState([]),[g,h]=v.useState([]),[S,E]=v.useState({initial:!1,provinces:!1,towns:!1}),[A,P]=v.useState(null),x=_[b]||"",j=_[r]||"";v.useEffect(()=>{const s=_[p];s&&(E(o=>({...o,initial:!0})),P(null),(async()=>{try{const f=(await I.get(`/api/town/${s}`)).data;f&&(f.country_id&&(l(b,String(f.country_id)),await t(f.country_id)),f.province_id&&(l(r,String(f.province_id)),await n(f.province_id)),l(p,String(f.id)))}catch(o){console.error("Error fetching initial town:",o),P(i("Error cargando la ubicación")||"Error loading location")}finally{E(o=>({...o,initial:!1}))}})())},[]),v.useEffect(()=>{x?t(x):(c([]),h([]))},[x]),v.useEffect(()=>{j?n(j):h([])},[j]);const t=async s=>{try{const o=await I.get(a,{params:{country_id:s}});c(Array.isArray(o.data)?o.data:o.data.provinces||[])}catch(o){console.error("Error fetching provinces:",o),c([])}},n=async s=>{try{const o=await I.get(N,{params:{province_id:s}});h(Array.isArray(o.data)?o.data:o.data.towns||[])}catch(o){console.error("Error fetching towns:",o),h([])}},m=s=>{const o=s.target.value;l(b,o),l(r,""),l(p,""),c([]),h([])},d=s=>{const o=s.target.value;l(r,o),l(p,""),h([])},L=s=>{l(p,s.target.value)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"row gy-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:y.country}),e.jsxs("select",{className:"form-select",name:b,value:x,onChange:m,children:[e.jsx("option",{value:"",children:i("opcion_selec")||"Select"}),Array.isArray(C)&&C.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:y.province}),e.jsxs("select",{className:"form-select",name:r,value:j,onChange:d,children:[e.jsx("option",{value:"",children:S.provinces?i("cargando")||"Cargando...":i("opcion_selec")||"Select"}),u.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:y.town}),e.jsxs("select",{className:"form-select",name:p,value:_[p]||"",onChange:L,children:[e.jsx("option",{value:"",children:S.towns?i("cargando")||"Cargando...":i("opcion_selec")||"Select"}),g.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),A&&e.jsx("small",{className:"text-danger",children:A})]})]})})}function re({auth:C,session:_,title:l,subtitle:b,workplace:r,countries:p}){var j;const a=z(),N=((j=U())==null?void 0:j.props)||{},{showConfirm:y}=J();N.locale,N.languages;const i=N.permissions||{},{data:u,setData:c,errors:g,processing:h}=B({name:r.name||"",description:r.description||"",country_id:r.country_id||"",province_id:r.province_id||"",town_id:r.town_id||"",cp:r.cp||"",address:r.address||"",website:r.website||"",logo:null}),S=t=>{const{name:n,type:m,checked:d,value:L,files:s}=t.target;m==="checkbox"?c(n,d):m==="file"?c(n,s.length?s[0]:null):c(n,L)};function E(t){t.preventDefault();const n=new FormData;n.append("_method","PUT"),Object.entries(u).forEach(([m,d])=>{m==="logo"&&d instanceof File?n.append(m,d):typeof d=="object"&&d!==null?n.append(m,JSON.stringify(d)):d!=null&&n.append(m,d)}),W.post(route("workplaces.update",r.id),n,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>console.log("Centro actualizado"),onError:m=>console.error("Errores:",m),onFinish:()=>console.log("Petición finalizada")})}const A=()=>{y({title:a("logo_eliminar"),text:a("logo_eliminar_confirm"),icon:"warning",onConfirm:()=>{W.delete(route("workplaces.logo.delete",r.id),{preserveScroll:!0,onSuccess:()=>{location.reload()}})}})},P=t=>{if(typeof t!="string")return"";const n=t.trim();return n?n.startsWith("http")||n.startsWith("//")||n.startsWith("/")?n:n.includes("storage/")?"/"+n.replace(/^\/+/,""):n.includes("workplaces/")||n.includes("companies/")?"/storage/"+n.replace(/^\/+/,""):`/storage/workplaces/${n.replace(/^\/+/,"")}`:""},x=[];return i!=null&&i["workplaces.index"]&&x.push({text:a("centros_volver"),icon:"la-angle-left",url:"workplaces.index",modal:!1}),i!=null&&i["workplaces.create"]&&x.push({text:a("centro_nuevo"),icon:"la-plus",url:"workplaces.create",modal:!1}),i!=null&&i["workplaces.destroy"]&&x.push({text:a("eliminar"),icon:"la-trash",method:"delete",url:"workplaces.destroy",params:[r.id],title:a("centro_trabajo_eliminar"),message:a("centro_trabajo_eliminar_confirm"),modal:!1}),e.jsxs($,{user:C.user,title:l,subtitle:b,actions:x,children:[e.jsx(O,{title:l}),e.jsxs("div",{className:"contents pb-4",children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12",children:e.jsxs("h2",{children:[a("centro_trabajo")," ",e.jsx("u",{children:r.name})]})}),e.jsxs("div",{className:"col-12 mt-2 mb-4",children:[e.jsxs("span",{className:"text-muted me-5",children:[a("creado"),": ",e.jsx("strong",{children:r.formatted_created_at})]}),e.jsxs("span",{className:"text-muted me-5",children:[a("actualizado"),": ",e.jsx("strong",{children:r.formatted_updated_at})]})]})]}),e.jsx("form",{onSubmit:E,children:e.jsxs("div",{className:"row gy-3",children:[e.jsxs("div",{className:"col-lg-6",children:[e.jsxs("label",{className:"form-label",children:[a("centro_trabajo"),"*"]}),e.jsx(T,{value:u.name,onChange:t=>c("name",t.target.value),maxLength:150,required:!0}),e.jsx(w,{message:g.name})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:a("descripcion")}),e.jsx("textarea",{className:"form-control",rows:"3",value:u.description,onChange:t=>c("description",t.target.value)}),e.jsx(w,{message:g.description})]}),e.jsx("div",{className:"col-12",children:e.jsx(M,{countries:p,formData:u,setData:c,provincesUrl:"/api/provinces",townsUrl:"/api/towns",labels:{country:a("pais"),province:a("provincia"),town:a("poblacion")}})}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:a("cp")}),e.jsx(T,{value:u.cp,onChange:t=>c("cp",t.target.value),maxLength:6}),e.jsx(w,{message:g.cp})]}),e.jsxs("div",{className:"col-md-8",children:[e.jsx("label",{className:"form-label",children:a("direccion")}),e.jsx(T,{value:u.address,onChange:t=>c("address",t.target.value),maxLength:150}),e.jsx(w,{message:g.address})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:a("website")}),e.jsx(T,{value:u.website,onChange:t=>c("website",t.target.value),maxLength:150}),e.jsx(w,{message:g.website})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:a("logo")}),r.logo?e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("img",{src:P(r.logo),alt:r.name,className:"img-thumbnail me-3",style:{maxWidth:"300px",objectFit:"contain"}}),e.jsx("button",{type:"button",className:"ms-2 btn btn-sm btn-danger",onClick:A,children:e.jsx("i",{className:"la la-trash"})})]}):e.jsx(q,{name:"logo",accept:"image/*",onChange:S,error:g.logo}),e.jsxs("p",{className:"pt-1 text-warning small",children:[e.jsx("span",{className:"me-5",children:a("imagen_formato")}),e.jsxs("span",{className:"me-5",children:[a("imagen_peso_max"),": 1MB"]}),a("imagen_medidas_recomendadas"),": 400x400px"]})]}),e.jsx("div",{className:"mt-4 text-end",children:e.jsx(G,{disabled:h,className:"btn btn-rdn",children:h?a("procesando")+"...":a("guardar")})})]})})]})]})}export{re as default};
