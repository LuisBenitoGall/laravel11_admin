import{j as e,S as R,x as W,A as K,X as O,r as L}from"./app-DRj95fl3.js";import{u as V,C as X,R as z,S as G,F as H,P as J}from"./useTableManagement-4XK40PxX.js";import{T as Y}from"./TableExporter-Cf6Xvvy9.js";import"./StatusButton-CIImyXxq.js";import{u as S}from"./useTranslation-BmHTxgDU.js";import{r as Z}from"./renderCellContent-C4U_4bOx.js";import{O as v,T}from"./OverlayTrigger-BXbmHDr2.js";import{T as I}from"./Table-CUvKlSmp.js";import"./es-D0X2UUFm.js";import"./floating-ui.dom-CQJTMakY.js";import"./SelectInput-CcScNE44.js";import"./TextInput-DHZ4LhQ-.js";import"./useSweetAlert-D-bXTlQV.js";import"./FileSaver.min-Bs0fFUdx.js";import"./typeof-QjJsDpFa.js";function Q({users:r,rows:y=null,tableId:g="tblUsers",queryParams:f={},columns:u=null,entityName:_="users",indexRoute:j="customers.edit",indexParams:i=null,destroyRoute:m="user-companies.destroy",filteredDataRoute:n=!1,labelName:A="usuarios",availableLocales:N=[]}){const s=S(),x=typeof f=="object"&&f!==null?f:{},o=(t=[])=>!Array.isArray(t)||t.length===0?"":t.map(a=>{const h=a.is_primary?"[P] ":"",b=a.is_whatsapp?" (WA)":"",C=a.label?` • ${a.label}`:"";return`${h}${a.e164}${b}${C}`}).join(`
`),d=Array.isArray(y)?y:Array.isArray(r==null?void 0:r.data)?r.data:Array.isArray(r)?r:[],l=r&&typeof r=="object"&&"meta"in r?r.meta:null,c=[{key:"name",label:s("nombre"),sort:!0,filter:"text",class_th:"",class_td:"",placeholder:s("nombre_filtrar"),render:({rowData:t,value:a})=>a||[(t==null?void 0:t.name)??"",(t==null?void 0:t.surname)??""].filter(Boolean).join(" ").trim()},{key:"created_at",label:s("fecha_alta"),sort:!0,filter:"date",class_th:"text-center",class_td:"text-end",placeholder:s("fecha_alta"),dateKeys:["date_from","date_to"]},{key:"email",label:s("email"),sort:!0,filter:"text",class_th:"",class_td:"",placeholder:s("email_filtrar")},{key:"phones",label:s("telefonos"),sort:!0,filter:"text",class_th:"",class_td:"",placeholder:s("telefonos_filtrar"),render:({rowData:t,value:a})=>{const h=Array.isArray(a)?a:[],b=h.find(M=>M.is_primary)??h[0]??null;if(!b)return"—";const C=Math.max(h.length-1,0),U=C>0?e.jsx(v,{placement:"top",overlay:e.jsx(T,{className:"ttp-top",style:{whiteSpace:"pre-line"},children:o(h)}),children:e.jsxs("span",{className:"badge bg-secondary ms-2",style:{cursor:"help"},children:[C," ",s("mas")]})}):null;return e.jsxs("span",{children:[b.e164,b.is_whatsapp?e.jsx("i",{className:"la la-whatsapp ms-2","aria-label":"WhatsApp"}):null,U]})}},{key:"position",label:s("cargo"),sort:!1,filter:"text",class_th:"",class_td:""},{key:"avatar",label:s("imagen"),sort:!1,filter:"",type:"image",icon:"user-tie",class_th:"text-center",class_td:"text-center",placeholder:""}],p=Array.isArray(u)&&u.length?u:c,{sortParams:$,perPage:P,setPerPage:w,visibleColumns:k,toggleColumnVisibility:q,SearchFieldChanged:B,sortChanged:E,filteredData:F}=V({table:g,allColumnKeys:p.map(t=>t.key),entityName:_,indexRoute:j,routeParams:i,destroyRoute:m,filteredDataRoute:n,labelName:A,queryParams:x});return e.jsxs("div",{children:[e.jsx(R,{title:s("usuarios")}),e.jsx("div",{className:"row",children:e.jsxs("div",{className:"controls d-flex align-items-center",children:[e.jsx(X,{columns:p,visibleColumns:k,toggleColumn:q}),e.jsx(z,{perPage:P,setPerPage:w}),e.jsx(Y,{filename:s(A),columns:p,fetchData:F})]})}),e.jsx("div",{className:"table-responsive",children:e.jsxs(I,{className:"table table-nowrap table-striped align-middle mb-0",id:g,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[p.map(t=>e.jsxs("th",{className:`${t.class_th??""} ${k.includes(t.key)?"":"d-none"}`.trim(),children:[s(t.label),t.sort&&e.jsx(G,{name:t.key,sortable:!0,sort_field:x.sort_field,sort_direction:x.sort_direction,sortChanged:E})]},t.key)),e.jsx("th",{className:"text-center",children:s("acciones")})]})}),e.jsx(H,{columns:p,queryParams:x,visibleColumns:k,SearchFieldChanged:B,indexRoute:j,indexParams:i}),e.jsxs("tbody",{children:[d.map(t=>e.jsxs("tr",{children:[p.map(a=>e.jsx("td",{className:`${a.class_td??""} ${k.includes(a.key)?"":"d-none"}`.trim(),children:Z(t[a.key],a,t)},a.key)),e.jsxs("td",{className:"text-end",children:[e.jsx(v,{placement:"top",overlay:e.jsx(T,{className:"ttp-top",children:s("editar")}),children:e.jsx(W,{href:route(`${_}.edit`,t.id),className:"btn btn-sm btn-info ms-1",children:e.jsx("i",{className:"la la-edit"})})},"edit-"+t.id),e.jsx(v,{placement:"top",overlay:e.jsx(T,{className:"ttp-top",children:s("eliminar")}),children:e.jsx("a",{href:route(`${_}.destroy`,t.id),className:"btn btn-sm btn-danger ms-1",title:s("eliminar"),children:e.jsx("i",{className:"la la-trash"})})},"delete-"+t.id)]})]},t.id)),d.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:p.length+1,className:"text-center py-4",children:s("sin_resultados")})})]})]})}),l&&e.jsx(J,{links:l.links,totalRecords:l.total,currentPage:l.current_page,perPage:l.per_page,onPageChange:t=>{K.get(route(j,i),{...x,page:t,per_page:P,sort_field:$.sort_field,sort_direction:$.sort_direction},{preserveState:!0})}})]})}function ye({users:r=null,rows:y=null,tableId:g="tblCompanyUsers",indexRoute:f="",indexParams:u=void 0,filteredDataRoute:_="",entityName:j="users"}){var N,s;const i=S(),m=((N=O())==null?void 0:N.props)||{},n=r??m.users??((s=m.company)==null?void 0:s.users)??{data:[],meta:{links:[],total:0,current_page:1,per_page:10}},A=L.useMemo(()=>Array.isArray(y)?y:Array.isArray(m.rows)?m.rows:(Array.isArray(n==null?void 0:n.data)?n.data:Array.isArray(n)?n:[]).map(o=>{const d=Array.isArray(o.phones)?o.phones:[],l=d.find(c=>c.is_primary)??d[0]??null;return{id:o.id,name:[o.name,o.surname].filter(Boolean).join(" "),position:o.position??null,email:o.email??null,phone_primary:(l==null?void 0:l.e164)??null,whatsapp:!!(l!=null&&l.is_whatsapp),phones_count:d.length,phones:d.map(c=>({e164:c.e164,type:c.type,label:c.label,is_primary:!!c.is_primary,is_whatsapp:!!c.is_whatsapp}))}}),[y,m.rows,n]);return e.jsx("div",{children:e.jsx(Q,{rows:A,users:n,tableId:g,queryParams:m.queryParams??{},indexRoute:f,indexParams:u,filteredDataRoute:_,entityName:j,i18n:{name:i("nombre"),position:i("puesto"),phone:i("telefono"),whatsapp:"WhatsApp",others:i("otros"),email:"Email",none:"—",moreSuffix:i("mas")}})})}export{ye as default};
