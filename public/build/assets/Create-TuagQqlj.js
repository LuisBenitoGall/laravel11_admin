import{X as ee,G as le,r,j as l,S as ae,a as x}from"./app-ipN4Lpei.js";import{A as se}from"./AdminAuthenticatedLayout-Dnf9viHk.js";import"./react-tooltip.min-Cg_Z_WJL.js";import{C as N}from"./Checkbox-C1MJcpfW.js";import{I as o}from"./InputError-BRgDUzXy.js";import{P as ne}from"./PrimaryButton-BZCXfhHb.js";import{S as d}from"./SelectSearch-Dj3dGkFf.js";import{T as te}from"./Textarea-My1RaWQC.js";import{T as g}from"./TextInput-CkCvusrN.js";import{u as ce}from"./useTranslation-C25qZZp5.js";import"./Header-bG4uIAmT.js";import"./useSweetAlert-CmWHaLPS.js";import"./OverlayTrigger-p_uRoGhW.js";import"./Sidebar-Dzqm1Vbq.js";import"./bootstrap.bundle.min-C7oov5VN.js";import"./NavLink-BFjf2yvp.js";import"./Dropdown-DaycTqil.js";import"./transition-B_klRBgP.js";import"./floating-ui.dom-CQJTMakY.js";import"./Select-aab027f3.esm-FB-Rrkkl.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./draftjs-to-html-ByXe0Pce.js";function Ee({auth:A,session:ie,title:y,subtitle:P,types:F,natureOptions:R,parentOptions:M,currencies:U,availableLocales:re}){var T;const s=ce(),C=((T=ee())==null?void 0:T.props)||{},b=C.permissions||{},{data:a,setData:n,post:q,reset:B,errors:i,processing:S}=le({name:"",nature:null,status:!0,manual_code:"",level1:null,level2:null,level3:null,level4:null,reconcile:!1,currency_id:null,normal_side:null,opening_balance:"",is_group:!1,parent_id:null,level:null,digits:"",notes:""}),[L,h]=r.useState([]),[$,p]=r.useState([]),[k,u]=r.useState([]),[v,D]=r.useState((M||[]).map(e=>({value:e.id,label:`${e.code} — ${e.name}`,meta:e}))),[z,w]=r.useState(!1),j=r.useRef(null),O=async(e="")=>{try{w(!0);const{data:c}=await x.get(route("accounting-accounts.parent-options"),{params:{q:e,limit:20}});D((c||[]).map(t=>({value:t.value??t.id,label:t.label??`${t.code} — ${t.name}`,meta:t.meta??{level:t.level??0,is_group:!0,code:t.code,name:t.name}})))}catch(c){console.error("Error fetching parent options:",c),D([])}finally{w(!1)}},G=e=>{j.current&&clearTimeout(j.current),j.current=setTimeout(()=>O(e||""),300)},m=(a.manual_code||"").trim()!=="",X=!!a.level1||!!a.level2||!!a.level3||!!a.level4;r.useEffect(()=>{m&&n(e=>{const c={...e,level1:null,level2:null,level3:null,level4:null};return h([]),p([]),u([]),c})},[m]);const H=X,J=e=>e?["asset","expense"].includes(e)?"debit":"credit":null;r.useEffect(()=>{n("normal_side",J(a.nature))},[a.nature]);const _=["asset","liability"].includes(a.nature);r.useEffect(()=>{(!_||a.is_group)&&(a.reconcile&&n("reconcile",!1),a.currency_id&&n("currency_id",null))},[a.nature,a.is_group]),r.useEffect(()=>{a.reconcile||n("currency_id",null)},[a.reconcile]),r.useEffect(()=>{var t;const e=v.find(I=>I.value===a.parent_id),c=(t=e==null?void 0:e.meta)==null?void 0:t.level;n("level",typeof c=="number"?c+1:null)},[a.parent_id,v]);const f=async(e,c)=>{if(e===1){if(n("level1",c||null),n(t=>({...t,level2:null,level3:null,level4:null})),h([]),p([]),u([]),!c)return;try{const{data:t}=await x.get(route("accounting-account-types.select",{type:c}));h(t||[])}catch{h([])}}if(e===2){if(n("level2",c||null),n(t=>({...t,level3:null,level4:null})),p([]),u([]),!c)return;try{const{data:t}=await x.get(route("accounting-account-types.select",{type:c}));p(t||[])}catch{p([])}}if(e===3){if(n("level3",c||null),n(t=>({...t,level4:null})),u([]),!c)return;try{const{data:t}=await x.get(route("accounting-account-types.select",{type:c}));u(t||[])}catch{u([])}}},K=!a.level1||L.length===0,Q=!a.level2||$.length===0,V=!a.level3||k.length===0,W=e=>e.replace(",",".").replace(/[^\d.]/g,""),Y=e=>n("opening_balance",W(e.target.value));function Z(e){e.preventDefault(),q(route("accounting-accounts.store"),{onSuccess:()=>B()})}const E=[];return b!=null&&b["accounting-accounts.index"]&&E.push({text:s("cuentas_volver"),icon:"la-angle-left",url:"accounting-accounts.index",modal:!1}),l.jsxs(se,{user:A.user,title:y,subtitle:P,actions:E,children:[l.jsx(ae,{title:y}),l.jsx("div",{className:"contents pb-4",children:l.jsx("form",{onSubmit:Z,children:l.jsxs("div",{className:"row gy-3",children:[l.jsxs("div",{className:"col-lg-6",children:[l.jsxs("label",{className:"form-label",children:[s("cuenta_nombre"),"*"]}),l.jsx(g,{type:"text",placeholder:s("cuenta_nombre"),value:a.name??"",onChange:e=>n("name",e.target.value),maxLength:100}),l.jsx(o,{message:i.name})]}),l.jsx("div",{className:"col-lg-1 text-center",children:l.jsxs("div",{className:"position-relative",children:[l.jsx("label",{htmlFor:"status",className:"form-label",children:s("estado")}),l.jsx("div",{className:"pt-1 position-relative",children:l.jsx(N,{className:"xl",name:"status",checked:a.status,onChange:e=>n("status",e.target.checked)})})]})}),l.jsx("div",{className:"w-100 m-0"}),l.jsxs("div",{className:"col-lg-3",children:[l.jsxs("label",{className:"form-label",children:[s("tipo_contable"),"*"]}),l.jsx(d,{name:"nature",options:R,value:a.nature,onChange:e=>n("nature",e?e.value:null),placeholder:s("opcion_selec"),required:!0}),l.jsx(o,{message:i.nature})]}),l.jsxs("div",{className:"col-md-3",children:[l.jsxs("label",{className:"form-label d-flex align-items-center gap-2",children:[s("saldo_esperado"),l.jsxs("small",{className:"text-muted",children:["(",s("sugerido_por_tipo"),": ",["asset","expense"].includes(a.nature)?s("debe"):s("haber"),")"]}),a.normal_side&&l.jsx("span",{className:`mt-2 badge ${a.normal_side==="debit"?"bg-primary":"bg-success"}`,children:a.normal_side==="debit"?s("debe"):s("haber")})]}),l.jsx(o,{message:i.normal_side})]}),l.jsxs("div",{className:"col-md-2",children:[l.jsx("label",{className:"form-label d-block",children:s("conciliable")}),l.jsxs("div",{className:"form-check form-switch pt-2",children:[l.jsx(N,{id:"reconcile",name:"reconcile",checked:!!a.reconcile,onChange:e=>n("reconcile",e.target.checked),disabled:a.is_group||!_}),l.jsx("label",{htmlFor:"reconcile",className:"ms-2",children:a.reconcile?s("si"):s("no")})]}),l.jsx("small",{className:"text-muted",children:_?"":s("solo_activo_pasivo")}),l.jsx(o,{message:i.reconcile})]}),l.jsxs("div",{className:"col-md-3",children:[l.jsx("label",{className:"form-label",children:s("divisa")}),l.jsx(d,{name:"currency_id",value:a.currency_id,options:(U||C.currencies||[]).map(e=>({value:e.id,label:`${e.name}`})),onChange:e=>n("currency_id",e?e.value:null),placeholder:s("divisa_selec"),isDisabled:a.is_group||!a.reconcile}),l.jsx(o,{message:i.currency_id})]}),l.jsxs("div",{className:"col-md-2",children:[l.jsx("label",{className:"form-label d-block",children:s("agrupadora")}),l.jsxs("div",{className:"form-check form-switch pt-2",children:[l.jsx(N,{id:"is_group",name:"is_group",checked:!!a.is_group,onChange:e=>n("is_group",e.target.checked)}),l.jsx("label",{htmlFor:"is_group",className:"ms-2",children:a.is_group?s("si"):s("no")})]}),l.jsx(o,{message:i.is_group})]}),!a.is_group&&l.jsxs("div",{className:"col-md-3",children:[l.jsx("label",{className:"form-label",children:s("saldo_apertura")}),l.jsx(g,{type:"number",inputMode:"decimal",step:"0.01",min:"0",placeholder:"0.00",value:a.opening_balance??"",onChange:Y,disabled:a.is_group}),l.jsxs("small",{className:"text-muted d-block mt-1",children:[s("moneda_base_empresa"),". ",s("se_aplica_en")," ",a.normal_side==="debit"?s("debe"):s("haber")]}),l.jsx(o,{message:i.opening_balance})]}),l.jsxs("div",{className:"col-lg-3",children:[l.jsx("label",{className:"form-label",children:s("cuenta_padre")}),l.jsx(d,{name:"parent_id",value:a.parent_id,options:v.filter(e=>{var c;return(c=e==null?void 0:e.meta)==null?void 0:c.is_group}),onChange:e=>n("parent_id",e?e.value:null),placeholder:s("cuenta_padre_selec"),onMenuOpen:()=>{v.length===0&&O("")},onSearchChange:G,isLoading:z}),l.jsx(o,{message:i.parent_id})]}),l.jsxs("div",{className:"col-md-2",children:[l.jsx("label",{className:"form-label",children:s("nivel")}),l.jsx("div",{className:"form-control bg-light",children:typeof a.level=="number"?a.level:"—"}),l.jsx("small",{className:"text-muted",children:s("nivel_autocalculado_aviso")})]}),l.jsx("h5",{className:"text-warning mb-0 mt-4",children:s("cuenta_contable_manual_texto")}),l.jsxs("div",{className:"col-lg-6",children:[l.jsx("label",{className:"form-label",children:s("numeracion_manual")}),l.jsx(g,{type:"text",placeholder:s("numeracion_manual"),value:a.manual_code??"",onChange:e=>n("manual_code",e.target.value),maxLength:100,disabled:H}),l.jsx(o,{message:i.manual_code})]}),l.jsx("div",{className:"py-3",children:l.jsx("hr",{})}),l.jsx("h5",{className:"text-warning",children:s("cuenta_contable_asistente_texto")}),l.jsxs("div",{className:"col-md-6",children:[l.jsxs("label",{className:"form-label",children:[s("nivel")," 1"]}),l.jsx(d,{name:"level1",value:a.level1,options:(F||[]).map(e=>({value:e.id,label:e.type})),onChange:e=>f(1,e?e.value:null),required:!m,placeholder:s("nivel_selec"),isDisabled:m})]}),l.jsxs("div",{className:"col-md-6",children:[l.jsxs("label",{className:"form-label",children:[s("nivel")," 2"]}),l.jsx(d,{name:"level2",value:a.level2,options:L.map(e=>({value:e.id,label:`${e.code} - ${e.name.charAt(0).toUpperCase()+e.name.slice(1)}`})),onChange:e=>f(2,e?e.value:null),isDisabled:m||K,placeholder:s("nivel_selec")})]}),l.jsxs("div",{className:"col-md-6",children:[l.jsxs("label",{className:"form-label",children:[s("nivel")," 3"]}),l.jsx(d,{name:"level3",value:a.level3,options:$.map(e=>({value:e.id,label:`${e.code} - ${e.name.charAt(0).toUpperCase()+e.name.slice(1)}`})),onChange:e=>f(3,e?e.value:null),isDisabled:m||Q,placeholder:s("nivel_selec")})]}),l.jsxs("div",{className:"col-md-6",children:[l.jsxs("label",{className:"form-label",children:[s("nivel")," 4"]}),l.jsx(d,{name:"level4",value:a.level4,options:k.map(e=>({value:e.id,label:`${e.code} - ${e.name.charAt(0).toUpperCase()+e.name.slice(1)}`})),onChange:e=>n("level4",e?e.value:null),isDisabled:m||V,placeholder:s("nivel_selec")})]}),l.jsx("h5",{className:"text-warning mb-0 mt-4",children:s("cuenta_contable_asistente_texto_2")}),l.jsxs("div",{className:"col-md-6",children:[l.jsxs("label",{className:"form-label",children:[s("completar_numeracion")," "]}),l.jsx(g,{type:"text",value:a.digits,onChange:e=>n("digits",e.target.value),maxLength:30}),l.jsx(o,{message:i.digits})]}),l.jsxs("div",{className:"col-12 mb-3",children:[l.jsx("label",{htmlFor:"notes",className:"form-label",children:s("notas")}),l.jsx(te,{name:"notes",value:a.notes||"",onChange:e=>n("notes",e.target.value),className:"form-control"}),l.jsx(o,{message:i.notes})]}),l.jsx("div",{className:"mt-4 text-end",children:l.jsx(ne,{disabled:S,className:"btn btn-rdn",children:S?`${s("procesando")}...`:s("guardar")})})]})})})]})}export{Ee as default};
